<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capital Planning - Authentication Test</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèóÔ∏è</text></svg>">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Login Page -->
        <div id="login-page" class="page active">
            <div class="login-box">
                <h1>Capital Planning System</h1>
                <p class="subtitle">Authentication Testing Interface</p>

                <form id="login-form">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" required>
                    </div>

                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" required>
                    </div>

                    <button type="submit" class="btn btn-primary">Login</button>
                </form>

                <div class="test-users">
                    <h3>Test Users:</h3>
                    <div class="user-card" onclick="fillCredentials('admin_user', 'admin_pass')">
                        <strong>admin_user</strong> / admin_pass
                        <div class="scopes">Scopes: assets:read, risk:analyze, investments:write</div>
                    </div>
                    <div class="user-card" onclick="fillCredentials('limited_user', 'limited_pass')">
                        <strong>limited_user</strong> / limited_pass
                        <div class="scopes">Scopes: assets:read</div>
                    </div>
                </div>

                <div id="login-error" class="error"></div>
            </div>
        </div>

        <!-- Dashboard Page -->
        <div id="dashboard-page" class="page">
            <div class="header">
                <h1>Capital Planning Dashboard</h1>
                <div class="user-info">
                    <span id="user-name"></span>
                    <button onclick="logout()" class="btn btn-secondary">Logout</button>
                </div>
            </div>

            <div class="token-info">
                <h2>Token Information</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <label>User:</label>
                        <span id="token-user"></span>
                    </div>
                    <div class="info-item">
                        <label>Scopes:</label>
                        <span id="token-scopes"></span>
                    </div>
                    <div class="info-item">
                        <label>Access Token Expires:</label>
                        <span id="token-expires"></span>
                    </div>
                    <div class="info-item">
                        <label>Refresh Token:</label>
                        <span id="has-refresh-token"></span>
                    </div>
                </div>
                <button onclick="refreshToken()" class="btn btn-secondary">Manual Refresh Token</button>
            </div>

            <div class="api-testing">
                <h2>API Endpoint Testing</h2>

                <div class="endpoint-group">
                    <h3>Asset Service (requires: assets:read)</h3>
                    <button onclick="testEndpoint('GET', '/assets')" class="btn btn-test">GET /assets</button>
                    <button onclick="testEndpoint('GET', '/assets/asset-001')" class="btn btn-test">GET /assets/asset-001</button>
                </div>

                <div class="endpoint-group">
                    <h3>Risk Service (requires: risk:analyze)</h3>
                    <button onclick="testRiskAnalysis()" class="btn btn-test">POST /risk/analyze</button>
                    <div class="note">Note: This takes 5 seconds (exceeds access token lifetime!)</div>
                </div>

                <div class="endpoint-group">
                    <h3>Investment Service (requires: investments:write)</h3>
                    <button onclick="testInvestmentOptimization()" class="btn btn-test">POST /investments/optimize</button>
                    <div class="note">Note: This takes 8 seconds (exceeds access token lifetime!)</div>
                </div>
            </div>

            <div class="response-section">
                <h2>Response</h2>
                <div id="loading" class="loading">Loading...</div>
                <pre id="response-output"></pre>
            </div>

            <div class="log-section">
                <h2>Activity Log</h2>
                <div id="activity-log"></div>
            </div>

            <div class="chatbot-section">
                <h2>AI Assistant</h2>
                <div class="chatbot-container">
                    <div id="chatbot-messages" class="chatbot-messages"></div>
                    <div class="chatbot-input-container">
                        <textarea
                            id="chatbot-input"
                            class="chatbot-input"
                            placeholder="Ask the AI assistant to analyze assets, assess risks, or create investment plans..."
                            rows="2"
                        ></textarea>
                        <button id="chatbot-send" class="btn btn-primary">Send</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script src="chatbot.js"></script>
</body>
</html>
